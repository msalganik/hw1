---
title: "Homework 1: Manipulating data"
author: "Matthew Salganik"
date: Due 2015-02-05
output: html_document
---

(@) **Please calculate 2+2 in the space below.**

```{r}
2+2
```

### Set-up the soccer data

Let's load in the soccer data and dplyr:

```{r}
suppressPackageStartupMessages(library(dplyr))
load(url("http://www.princeton.edu/~mjs3/soc504_s2015/CrowdstormingDataJuly1st.RData"))
soccer.data <- tbl_df(soccer.data)
```

### A robustness check 

In lab, we calculated the rate of red cards for players of different skin tone.  Now, we are going to see how robust our conclusions were to some of the choices that we made in the analysis.  In particular, it is important to know that in soccer there are actually two ways to get a red card: a direct red card and getting two yellow cards (which equals one red card).

(@directreds) **Create a table like the one were made in lab where the outcome of interest is rate of direct red cards.**

```{r}
# [ your code here ]
```

(@allreds) **Imagine that you submitted the table above in a paper (Of course, in a real paper you would create a graph, but we have not learned `ggplot2` yet.) Create a table like the one above but where the outcome of interest is rate of all forms of red cards (direct red cards + two yellow cards).**

```{r}
# [ your code here ]
```

(@) In words, compare your answers in questions @directreds and @allreds.  Do this choice make a difference?

[ your text here ]

### Looking at subsets of the data, by country

Imagine that you presented these results at ASA, and an audience member speculated the relationship between skin tone and red cards would be different in the different soccer leagues.

(@byleague) **Create a table that shows, for each league, the rate of red cards by skin color.  In this case, please use **

```{r}
# [ your code here ]
```

(@) **In words, what would you conclude from your response to @byleague?**

[ your text here ]

### Looking at subsets of the data, by position

Imagine that after addressing this concern from the an ASA audience member, you are chating with a colleague about this project over coffee.  Your colleague thinks that leagues are not important, but that positions should be important.  That is the relationship between skin color and red card rate should be different for goalie, defenders, midfielders, and attackers.

(@) **As a first step, create a new factor `position.type` that recodes the current position factor into four groups.  I recommend you do this will the function `mapvalues()` in `plyr`.  To show you how that function works, I'll create a new variable that stores the currency used by the league.country. (I realize that there is not much reason to want to know the currency used by the league, but just bear with me.)**

```{r}
soccer.data$currency <- plyr::mapvalues(soccer.data$league.country,
                                        from=c("England", "France", "Germany", "Spain"), 
                                        to=c("Pound", "Euro", "Euro", "Euro")) 
```

Notice that I'm not loading the whole `plyr` package because it can cause weird conflicts with `dplyr`.  Therefore, I call the function like this `plyr::mapvalues`

(@) **Modify the above code to create a new factor called position.type which has four values: goalie, defenders, midfielders, and attackers.**

```{r}
# [ your code here ]
```

(@) **Optional Challenge: Create the factor we need using a different method, either from base R or from another package.**

```{r}
# [ your code here; optional ]
```


(@byposition) **Create a table that shows, for each position, the rate of red cards by skin color.  In this case, please use all forms of red cards.**

```{r}
# [ your code here ]
```

(@) **In words, what would you conclude from your response to @byleague?**

[ your text here ]

## Watch how this works with a different dataset: Gapminder

Just to show you that this all works with different data, you will now do some analysis with the [Gapminder](http://www.gapminder.org/) data, as currated and cleaned by [Jenny Bryan](https://github.com/jennybc/gapminder).

```{r}
require(dplyr)
load(url("http://www.princeton.edu/~mjs3/soc504_s2015/gapminder.RData"))
gapminder <- tbl_df(gapminder)
glimpse(gapminder)
head(gapminder)
tail(gapminder)
```

(@) **Is this data in third normal form?**

[ yes / no ]

(@) Explain:

[ your text here ]

(@) **Is this a sensible structure for data storage?**

[ yes / no ]

(@) **Is this a sensible structure for data analysis?**

[ yes / no ]

(@) **For each continent, show the mean GDP in each of the years in the data.**

```{r}
gapminder %>% 
  group_by(continent, year) %>%
  summarise(mean(gdpPercap))
```

(@) **Which country had the highest GDP per captia in Africa in 1952?**  Note you don't need to produce a data.frame with a single country to answer this question.  A data.frame with the appropriate countries sorted is enough.

```{r}
gapminder %>%
  filter(continent=="Africa", year==1952) %>%
  arrange(desc(gdpPercap)) %>%
  select(country, gdpPercap)
```

(@) **Which country had the highest GDP (not GDP per captia) in any year in the data?**  Note you don't need to produce a single country to answer this question.  A data.frame with the appropriate countries sorted is enough.

```{r}
gapminder %>%
  mutate(gdp = gdpPercap * pop) %>%
  arrange(desc(gdp)) %>%
  select(country, year, gdp)
```

(@) **Which continent had the most variation in life expectancy in 2007?** Note you don't need to produce a single country to answer this question.  A data.frame with the appropriate countries sorted is enough.

```{r}
gapminder %>%
  filter(year=="2007") %>%
  group_by(continent) %>%
  summarise(life.exp.var = var(lifeExp))
```

(@openq) **Optional challenge: Create a question that will require you to use all 5 `dplyr` verbs: `filter`, `arrange`, `select`, `mutate`, and `summarise`.**

[ your text here; optional ]

(@) **Challenge problem: Now show the code to answer question @openq.**

```{r}
# your code here; optional
```

## More practice with data structures

`R` comes with the dataset `ldeaths`, which records the monthly deaths from bronchitis, emphysema and asthma in the UK, 1974–1979.  For more information type "?ldeaths"

(@) **Is this data tidy?**

[ yes / no ]

(@) **Explain**

[ your text here ]

`R` comes with the dataset `mtcars`, which shows fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models), as taken from the 1974 Motor Trend US magazine.  For more information type "?mtcars"

(@) **Is this data tidy?**

[ yes / no ]

(@) **Explain**

[ your text here ]

`R` comes with the dataset `quakes`, which shows 1000 seismic events near Fiji.  For more information type "?quakes"

(@) **Is this data tidy?**

[ yes / no ]

(@) **Explain**

[ your text here ]

#### This is helpful for debugging, please don't change it

```{r}
sessionInfo()
```


